<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Migration Flow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="#">
  <style> body {margin: 0; font-family: sans-serif; width: 100vw; height: 100vh; overflow: hidden;}</style>

  <!-- Stylesheet -->
  <link rel="stylesheet" type="text/css" href="./css/main.css">

  <!-- DeckGl library - processing geospatial data-->
  <script src="https://unpkg.com/deck.gl@^8.4.0/dist.min.js"></script>
	<script src="https://unpkg.com/@deck.gl/carto@^8.4.0/dist.min.js"></script>

  <!-- Basemap loading -->
  <link href="https://libs.cartocdn.com/mapbox-gl/v1.13.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://libs.cartocdn.com/mapbox-gl/v1.13.0/mapbox-gl.js"></script>

  <!-- Document data manipulation-->
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <script src="https://unpkg.com/deck.gl@^8.0.0/dist.min.js"></script>

</head>


<body>
    <div class="navContainer">
        <div class="logo-box">
          <a href="/">
          <img src="./images/uzh_logo_e_pos_web_assoc_zone.jpg" height="70px"></img>
          </a>
        </div>
        <nav>
          <ul>
            <li className="introNav active"><a href="#introNav">Home</a></li>
            <li className="backgroundNav"><a href="#backgroundNav">background</a></li>
            <li className="mapNav"><a href="#mapNav">map</a></li>
            <li className="summaryNav"><a href="#summaryNav">summary</a></li>
            <li className="referencesNav"><a href="#referencesNav">references</a></li>
            <li className="authorsNav"><a href="#authorsNav">authors</a></li>
          </ul>
        </nav>
      </div>
      <div class="scrollableScreen" id="scrollableScreen">
        <div class="intro page" id="introNav">
          <div class="e">Remittance and Migration Flow:</div> 
          <div class="e"> 
              <span class="s"> Global Patterns</span>
          </div>
        </div>
        <div class="background page" id="backgroundNav">
          <div class= "text-box"> 
            <div class="text-title">Background</div>
              <div class= "text-section">
                <p> <b>Why remittances matter:</b><br>
                  The Sustainable Development Goals (SDG) are an urgent call
                  for action to reduce all forms of inequality and deprivation 
                  as well as to preserve the nature of our planet (UN, 2021). 
                  These goals are to be achieved by 2030. Migration is a cross-cutting 
                  issue and is relevant to all seventeen goals (Migration Data 
                  Portal, no date). While it is not explicitly one of the goals, 
                  it is crucial to understand migration patterns because of its 
                  relationship to the goals above. This Web Page provides an 
                  overview of migration and its aftereffect: Remittances.<br>
                  
                  <br>Remittances are household incomes from foreign countries 
                  that result from the temporary or permanent movement of people 
                  to those countries (IMF, 2009). In the past years the interest 
                  in remittances increased and bridges between academic and 
                  political spheres were created (Gubert, 2017). A specific United 
                  Nation goal is to decrease transaction costs (SDG 10.c) of migrant 
                  remittances, as this is one of the most important and mature steps 
                  taken to increase incomes in developing countries (IOM, 2017). 
                  Concrete examples in the Global Forum on Remittances, Investment 
                  and Development (GFRID, 2017) have shown how migrant remittances 
                  and diaspora investments were reducing poverty and hunger and 
                  promoting access to health and education (UN, no date).<br>
                  <br>
                  <b>7 facts about remittances:</b>
                  <li>About one in nine people worldwide are supported by migrant workers’ remittances.</li>
                  <li>What migrants send home represents only 15 per cent of their income.</li>
                  <li>The money they receive is key in helping millions out of poverty, as it can represent a large part of household income.</li>
                  <li>Remittances, in particular, can help achieve at least seven of the 17 SDGs.</li>
                  <li>Half of remittances go directly to rural areas where the world's poorest people live.</li>
                  <li>They are three times more important than international aid and counting.</li>
                  <li>Remittances remain expensive to send.</li>
                  <li style="display: inline">(UN, 2019)</li><br>
                  <br><br>
                  In order to approach the reduction of inequalities – especially 
                  the remittance costs, it is crucial to better understand the global 
                  pattern and dynamics of migration and financial flows between countries. 
                  According to the Global Knowledge Partnership on Migration and Development 
                  (KNOMAD), which has the same objective, this knowledge can be used by 
                  policy makers in sending and receiving countries (Gubert, 2017).
                </p>
              </div>
          </div>
        </div>
        <div class="background page" id="backgoundNav">
          <iframe src="https://embed.ted.com/talks/lang/en/dilip_ratha_the_hidden_force_in_global_economics_sending_money_home"
                      height=80% 
                      width=80%
                      allowfullscreen=true>    
          </iframe>
        </div>
        <div class="mapPage page" id="mapNav">
          <div class="mapContainer">
              <div class="map" id="map"></div>
          </div>
          <div class="optionBox">
            <fieldset class="layerSelection">
              <legend>Select a layer:</legend>
              <div>
                <input type="radio" id="e" name="inout" value="e" onclick="updateLayerName(this.value, 'inout')"
                      checked>
                <label for="e">Emigrants</label>
              </div>
          
              <div>
                <input type="radio" id="i" name="inout" value="i" onclick="updateLayerName(this.value, 'inout')">
                <label for="i">Immigrants</label>
              </div>

            </fieldset>
            <fieldset class="layerSelection">
              <legend>Select a year:</legend>
              <div>
                <input type="radio" id="e10" name="layername" value="10" onclick="updateLayerName(this.value, 'year')"
                      checked>
                <label for="e10">2010</label>
              </div>
          
              <div>
                <input type="radio" id="e15" name="layername" value="15" onclick="updateLayerName(this.value, 'year')">
                <label for="e15">2015</label>
              </div>
          
              <div>
                <input type="radio" id="e20" name="layername" value="20" onclick="updateLayerName(this.value, 'year')">
                <label for="e20">2020</label>
              </div>
            </fieldset>
        </div>
        </div>
        <div class="summary page" id="summaryNav">
          <div class= "text-box"> 
            <div class="text-title">Summary</div>
              <div class= "text-section">
                <p> Hier kommt der Text hin </p>
              </div>
          </div>
        </div>
        <div class="references page" id="referencesNav">
          <div class= "text-box"> 
            <div class="text-title">References</div>
              <div class= "text-section">
                <p> International Monetary Fund (IMF) (2009) <i>International Transactions in Remittances: Guide for Compilers and Users.</i> doi: 10.1111/j.1468-2435.2009.00540.x.<br>
                  <br>Gubert, F. (2017) <i>Migration, Remittances and Development: Insights from the Migration and Development Conference, Revue d’Economie du Developpement,</i> 25(3–4), pp. 29–44. doi: 10.3917/edd.313.0029.<br>
                  <br>IOM (2017) <i>International dialogue on migration: Follow-up and review of migration in the sustainable development goals,</i> in.<br>
                  <br>Portal, M. D. (no date) <i>Migration data and the Sustainable Development Goals (SDGs).</i> Available at: https://www.migrationdataportal.org/sdgs?node=0.<br>
                  <br>UN (2019) <i>Remittances matter: 8 facts you don’t know about the money migrants send back home.</i> Available at: https://www.un.org/development/desa/en/news/population/remittances-matter.html.<br>
                  <br>UN (2021) <i>The Sustainable Development Goals Report 2021.</i><br>
                  <br>UN (no date) <i>Putting a spotlight on the role of migrant remittances in achieving the SDGs.</i> Available at: https://www.un.org/hi/desa/putting-spotlight-role-migrant-remittances-achieving-sdgs.
                   </p>
              </div>
          </div>
        </div>
        <div class="authors page" id="authorsNav">
          <div class="profile-card">
            <div class="img">
              <img src="./images/team-1.jpg" ></img>
            </div>
            <div class="caption">
              <h3>Annina Ardüser</h3>
              <p>Master Student GIS</p>
            </div>
            <div class="social-links">
            </div>
          </div>
          <div class="profile-card">
          <div class="img">
              <img src="./images/team-2.jpg"></img>
          </div>
          <div class="caption">
            <h3>Fiona Federer</h3>
            <p>Master Student GIS</p>
            <div class="social-links">
            </div>
          </div>
          </div>
            <div class="profile-card">
              <div class="img">
                <img src="./images/team-3.jpg"></img>
              </div>
              <div class="caption">
                <h3>Silvan Caduff</h3>
                <p>Master Student GIS</p>
              <div class="social-links">
              </div>
            </div>
          </div>
        </div>
      </div>
</body>


<script language="JavaScript">  
    const pages = document.querySelectorAll('.page');
    const navLi = document.querySelectorAll('nav li');
    const scr = document.getElementById('scrollableScreen');
    
    scr.onscroll = () => {
    var current = "";
    pages.forEach((page) => {
        const pageTop = page.offsetTop;
        if(scr.scrollTop >= (pageTop - 400)) {
        current = page.getAttribute('id');
        }
    });
    
    navLi.forEach((li) => {
        li.classList.remove('active');
        
        if(li.classList.contains(current)){
        li.classList.add('active');
        }
    });
    };

    // Get components from the deckgl library
    const {DeckGL, GeoJsonLayer, ArcLayer, ScatterplotLayer} = deck;

    // Create deck instance 
    const deckgl = new DeckGL({
        mapStyle: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
        container: 'map',
        initialViewState: {
          longitude: 6,
          latitude: 50,
          zoom: 3,
          maxZoom: 15,
          pitch: 30,
          bearing: 0
        },
        controller: true,
        layers: []
      });

      // create proportional symbols layers
    const symbolsLayer = new ScatterplotLayer({
        data: './aa_remittances/aa_remittances_IN_GDP_millions_WGS84.json',
        getPosition: d => [d.X, d.Y], // Koordinaten werden noch nicht richtig ausgewählt
        getRadius: d => Math.sqrt((d.R_IN_2017)/Math.Pi),
        getColor: [155, 40, 0],
        radiusMinPixels: 2
      })
      
    // Define Arc colors
    const inFlowColors = [
      [255, 255, 204],
      [199, 233, 180],
      [127, 205, 187],
      [65, 182, 196],
      [29, 145, 192],
      [34, 94, 168],
      [12, 44, 132]
    ];

    const outFlowColors = [
      [255, 255, 178],
      [254, 217, 118],
      [254, 178, 76],
      [253, 141, 60],
      [252, 78, 42],
      [227, 26, 28],
      [177, 0, 38]
    ];

    

    var dataSorted = [];
    var countyLayer = '' ;
    var arcLayer = '';
    var inout = 'e';
    var year = '10';
    var startCountry = 'GERMANY';
    

    function updateLayerName(value, type) {
      if (type == 'year'){
        year = value;
      } else {
        inout=value;
      }
      layerName = inout+year;
      layerChange(layerName);
    }


    layerChange("e10");

    function layerChange(layerName) {
      fetch('./data/'+ layerName +'.json')
      .then(res => res.json())
      .then(data => {
        console.log(data);
        dataSorted = keysrt(data.features, ['properties','COUNTRY']);

        countyLayer = new GeoJsonLayer({
          id: 'geojson',
          data,
          stroked: false,
          filled: true,
          autoHighlight: true,
          getFillColor: () => [0, 0, 0, 0],
          onClick: info => updateLayers(info.object),
          pickable: true
        });

        updateLayers(
          dataSorted.find(f => f.properties.COUNTRY === startCountry)
        );
      });
      render();
    }

    function updateLayers(dataFeature) {
        selectedFeature = dataSorted.find(f => f.properties.COUNTRY === dataFeature.properties.COUNTRY);
        startCountry = dataFeature.properties.COUNTRY;

        const flows = selectedFeature.properties.flows;
        const centroid = selectedFeature.geometry.centroid;

        const arcs = Object.keys(flows).map(toId => {
          const f = dataSorted[toId];
          return {
            source: centroid,
            target: f.geometry.centroid,
            value: flows[toId]
          };
        });

        const scale = d3.scaleQuantile()
          .domain(arcs.map(a => Math.abs(a.value)))
          .range(inFlowColors.map((c, i) => i));

        arcs.forEach(a => {
          a.gain = Math.sign(a.value);
          a.quantile = scale(Math.abs(a.value));
        });

        console.log(arcs);

        arcLayer = new ArcLayer({
          id: 'arc',
          data: arcs,
          getSourcePosition: d => d.source,
          getTargetPosition: d => d.target,
          getSourceColor: d => (d.gain > 0 ? inFlowColors : outFlowColors)[d.quantile],
          getTargetColor: d => (d.gain > 0 ? inFlowColors : outFlowColors)[d.quantile],
          widthMinPixels: 3,
          greatCircle: true,
          getHeight: 0.1
        });

        console.log(countyLayer);
        console.log(arcLayer);

        deckgl.setProps({
          layers: [countyLayer, arcLayer]
        });
    }

    function keysrt(arr, keyArr, reverse) {
          var sortOrder = 1;
          if(reverse)sortOrder = -1;
          return arr.sort(function(a, b) {
              var x=a,y=b;
              for (var i=0; i < keyArr.length; i++) {
                x = x[keyArr[i]];
                y = y[keyArr[i]];
              }
              return sortOrder * ((x < y) ? -1 : ((x > y) ? 1 : 0));
          });
      }



    // How to handle layer visibility in the future
    const layerVisibility = {e10:true, e15:false, e20:false, i10:false, i15:false, i20:false} // fill in all the layers that are needed

    function render() {
      console.log(countyLayer);
      console.log(arcLayer);
      deckgl.setProps({layers:[countyLayer, arcLayer]});
    }

</script>